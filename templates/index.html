<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMD+CM 요점정리 모의시험</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f8f9fa; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px;
                      border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        h1 { text-align: center; cursor: pointer; }
        /* ✅ 상단 고정 스타일 */
        .answered-count-fixed {
            position: fixed;
            top: 10px;
            right: 20px;
            background-color: #007bff;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }
        .question { margin-bottom: 20px; }
        .choices label { display: block; margin-bottom: 5px; }
        .submit-btn { display: block; width: 100%; padding: 10px; background: #007bff;
                      color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; }
        .submit-btn:hover { background: #0056b3; }
    </style>
</head>
<body>

<!-- ✅ 고정된 문항 수 표시 -->
<div id="answered-count" class="answered-count-fixed">
    0 / {{ questions|length }} 문제 답변 완료
</div>

<div class="container">
    <h1 id="quiz-title">SMD+CM 요점정리 모의시험</h1>

    <form method="POST" action="/submit" id="quiz-form">
        {% for i in range(questions|length) %}
        <div class="question">
            <p><strong>{{ i + 1 }}. {{ questions[i]['question'] }}</strong></p>
            {% if questions[i].get('image') %}
                <img src="{{ url_for('static', filename=questions[i]['image']) }}" alt="문제 이미지"
                     style="max-width: 100%; height: auto;">
            {% endif %}
            <div class="choices">
                {% for choice in questions[i]['choices'] %}
                <label>
                    <input type="radio" name="q{{ i }}" value="{{ choice }}">
                    {{ choice }}
                </label>
                {% endfor %}
            </div>
            <input type="hidden" name="question_index_{{ i }}" value="{{ questions[i]['original_index'] }}">
        </div>
        {% endfor %}
        <button type="submit" class="submit-btn">제출하기</button>
    </form>
</div>

<script>
    // 관리자 진입: 제목 5번 클릭
    let clickCount = 0;
    document.getElementById("quiz-title").addEventListener("click", function () {
        clickCount++;
        if (clickCount >= 5) {
            const password = prompt("관리자 비밀번호를 입력하세요:");
            if (password) {
                fetch("/admin-login", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: `password=${encodeURIComponent(password)}`
                })
                .then(response => {
                    if (response.redirected) {
                        window.location.href = response.url;
                    } else {
                        alert("비밀번호가 올바르지 않습니다.");
                    }
                });
            }
            clickCount = 0;
        }
        setTimeout(() => clickCount = 0, 2000);
    });

    // ✅ 현재 푼 문항 수 표시 기능
    const totalQuestions = {{ questions|length }};
    const answeredCountEl = document.getElementById("answered-count");

    function updateAnsweredCount() {
        let answered = 0;
        for (let i = 0; i < totalQuestions; i++) {
            if (document.querySelector(`input[name="q${i}"]:checked`)) {
                answered++;
            }
        }
        answeredCountEl.textContent = `${answered} / ${totalQuestions} 문제 답변 완료`;
    }

    document.querySelectorAll('input[type="radio"]').forEach(radio => {
        radio.addEventListener('change', updateAnsweredCount);
    });

    updateAnsweredCount();

    // 문제 강제 선택 검증
    document.getElementById("quiz-form").addEventListener("submit", function (e) {
        for (let i = 0; i < totalQuestions; i++) {
            const selected = document.querySelector(`input[name="q${i}"]:checked`);
            if (!selected) {
                e.preventDefault();
                alert("모든 문제에 답을 선택해야 제출할 수 있습니다.");
                const questionElement = document.querySelector(`input[name="q${i}"]`).closest('.question');
                questionElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
        }
    });
</script>
</body>
</html>
